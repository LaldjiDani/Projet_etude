{% extends "base.html" %}

{% block content %}
<div class="text-center mb-10">
    <h1 class="text-4xl font-extrabold text-gray-800 mb-2">Une Petite Faim ?</h1>
    <p class="text-gray-600">DÃ©couvrez les meilleurs restaurants prÃ¨s de chez vous</p>
</div>

<div class="max-w-5xl mx-auto mb-12">
    <form action="{{ url_for('index') }}" method="get" class="bg-white p-4 rounded-xl shadow-sm border border-gray-200 flex flex-col md:flex-row gap-4 items-center">
        
        <div class="flex-grow w-full md:w-auto">
            <input type="text" name="q" placeholder="Nom du restaurant (ex: Pizza...)" 
                   value="{{ request.args.get('q', '') }}" 
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800 focus:border-transparent">
        </div>

        <div class="w-full md:w-1/4">
            <select name="ville" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800 bg-white">
                <option value="">ğŸ“ Toutes les villes</option>
                {% for v in villes %}
                    <option value="{{ v }}" {% if request.args.get('ville') == v %}selected{% endif %}>
                        {{ v }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="w-full md:w-1/4">
            <select name="mot" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-800 bg-white">
                <option value="">ğŸ” Toutes catÃ©gories</option>
                {% for m in mots_cles %}
                    <option value="{{ m }}" {% if request.args.get('mot') == m %}selected{% endif %}>
                        {{ m }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="flex gap-2 w-full md:w-auto">
            <button type="submit" class="flex-grow bg-gray-800 text-white px-6 py-2 rounded-lg font-semibold hover:bg-gray-700 transition duration-300">
                ğŸ”
            </button>
            <a href="{{ url_for('index') }}" class="px-4 py-2 text-gray-500 hover:text-red-500 transition duration-300 border border-gray-300 rounded-lg" title="RÃ©initialiser">
                âœ•
            </a>
        </div>
    </form>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    
    {% for resto in restaurants %}
    <div class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition duration-300 border border-gray-100 flex flex-col">
        
        <div class="h-40 bg-gray-200 flex items-center justify-center relative">
            <span class="text-4xl">ğŸ½ï¸</span>
            
            {% if est_ouvert(resto.ouverture, resto.fermeture) %}
                <span class="absolute top-2 right-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                    OUVERT
                </span>
            {% else %}
                <span class="absolute top-2 right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                    FERMÃ‰
                </span>
            {% endif %}
        </div>

        <div class="p-5 flex-grow">
            <div class="flex justify-between items-start mb-2">
                <h3 class="text-xl font-bold text-gray-800 truncate">{{ resto.nomresto }}</h3>
                
                <span class="flex items-center text-sm font-bold {{ 'text-yellow-500' if (resto.note_moyenne is defined and resto.note_moyenne > 0) else 'text-gray-300' }}">
                    â˜… {{ resto.note_moyenne if resto.note_moyenne else 'N/A' }}
                </span>
            </div>

            <p class="text-sm text-blue-600 font-medium mb-3">
                {{ resto.mots_cles if resto.mots_cles else 'GÃ©nÃ©raliste' }}
            </p>

            <div class="text-sm text-gray-500 space-y-1">
                <p class="flex items-center gap-2">
                    ğŸ“ {{ resto.nomville }}
                </p>
                <p class="flex items-center gap-2">
                    ğŸ•’ {{ resto.ouverture }} - {{ resto.fermeture }}
                </p>
            </div>
            
            </div>

        <div class="p-4 bg-gray-50 border-t border-gray-100 mt-auto">
            <a href="{{ url_for('restaurant_detail', nom_resto=resto.nomresto) }}" class="block w-full text-center bg-gray-800 text-white font-semibold py-2 rounded hover:bg-gray-700 transition">
                Voir la carte
            </a>
        </div>
    </div>
    {% else %}
    <div class="col-span-full text-center py-10">
        <div class="text-6xl mb-4">ğŸ˜¢</div>
        <h3 class="text-xl font-bold text-gray-700">Aucun restaurant trouvÃ©</h3>
        <p class="text-gray-500">Essayez de modifier vos critÃ¨res de recherche.</p>
        <a href="{{ url_for('index') }}" class="inline-block mt-4 text-blue-600 hover:underline">Voir tous les restaurants</a>
    </div>
    {% endfor %}

</div>
{% endblock %}